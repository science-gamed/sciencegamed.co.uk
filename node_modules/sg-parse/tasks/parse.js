var readPosts, fs;

fs = require( 'fs' );

module.exports = function ( grunt ) {
	
	grunt.registerTask( 'parse', 'Parse markdown content into JSON', function () {
		var fs, config, subtask, generate, generators, generator, data, id, pageCollections;

		grunt.config.requires( 'parse' );

		fs = require( 'fs' );
		
		runTask = function ( task ) {
			var subtask, i, result;

			if ( !task.src || !task.dest ) {
				for ( subtask in task ) {
					runTask( task[ subtask ] );
				}
				return;
			}

			files = grunt.file.expand( task.src );
			parser = require( 'parsers/' + task.parser );

			fs.writeFileSync( task.dest, JSON.stringify( parser( files ), null, '\t' ) );
		};

		runTask( grunt.config( 'parse' ) );
	});

};