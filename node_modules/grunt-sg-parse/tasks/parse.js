/*jslint white: true */
/*global module, require */

module.exports = function ( grunt ) {
	
	'use strict';

	var path;

	path = require( 'path' );

	grunt.registerMultiTask( 'parse', 'Parse markdown content into JSON', function () {
		var config, files, parser, data, cwd;

		config = this.data;

		cwd = config.cwd;

		this.files.forEach( function ( file ) {
			var destJson, srcFiles, result;

			result = [];

			file.src.forEach( function ( filepath ) {
				var relPath, data;

				relPath = path.relative( cwd, filepath );
				data = grunt.file.read( filepath );

				result[ result.length ] = config.parser( data, relPath );
			});

			data = JSON.stringify( result, null, '\t' );

			grunt.file.write( file.dest, data );
		});

		
	});

};