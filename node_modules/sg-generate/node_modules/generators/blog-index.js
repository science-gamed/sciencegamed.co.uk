var blogPost, mustache, getPath, sortByDate, parseMarkdown;


mustache = require( 'mustache' );
getPath = require( 'utils/getPath' );
sortByDate = require( 'utils/sortByDate' );
parseMarkdown = require( 'node-markdown' ).Markdown;


blogPost = function ( data ) {
	var pages, i, id, posts;

	posts = data.blogposts.sort( sortByDate ).slice( 0, 5 ).map( function ( post ) {
		post.preview = parseMarkdown( post.markdown.substr( 0, 250 ) + '...' );
		return post;
	});

	pages = [
		{
			path: 'blog/index.html',
			data: mustache.render( data.templates.blogindex, { posts: posts }, data.templates.partials )
		}
	];

	return pages;
};


module.exports = blogPost;